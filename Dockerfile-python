# jupyter-langs:python
FROM continuumio/miniconda3:4.8.2

LABEL Maintainer="HeRoMo"
LABEL Description="Jupyter lab for Python3"
LABEL Version="4.0.0"

ENV HOME=/root
ENV NOTEBOOK_DIR=/notebooks
ENV JUPYTER_DIR=/opt/jupyter
ENV MATPLOTLIBRC=/opt/jupyter

# Install required packages
RUN apt-get update \
    && apt-get upgrade -y \
    && apt-get install -y --no-install-recommends \
            build-essential \
            cmake \
            gnupg \
            locales \
            fonts-noto-cjk \
            # for ZeroMQ
            libtool \
            libffi-dev \
            libzmq3-dev \
            libczmq-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set Locale
ENV LANG=ja_JP.UTF-8
ENV LC_ALL=ja_JP.UTF-8
RUN echo "LC_ALL=ja_JP.UTF-8" >> /etc/environment \
    && echo "ja_JP.UTF-8 UTF-8" >> /etc/locale.gen \
    && echo "LANG=ja_JP.UTF-8" > /etc/locale.conf \
    && locale-gen ja_JP.UTF-8

# Install Jupyter
RUN conda update -c conda-forge --all
RUN conda install -y -c conda-forge  \
                python=3.8 \
                conda-build \
                pandas \
                scipy \
                bokeh \
                matplotlib \
                tensorflow \
                keras \
                jupyter \
                jupyterlab \
                libiconv \
                jupyter_contrib_nbextensions \
    && conda build purge-all
RUN jupyter contrib nbextension install --user
RUN pip install tflearn

RUN mkdir -p $NOTEBOOK_DIR \
    && mkdir -p $JUPYTER_DIR \
    && mkdir -p $MATPLOTLIBRC
COPY conf/matplotlibrc $MATPLOTLIBRC/matplotlibrc
COPY conf/jupyter_notebook_config.py $JUPYTER_DIR/jupyter_notebook_config.py

EXPOSE 8888
#CMD ["jupyter", "notebook", "--no-browser", "--ip=0.0.0.0", "--allow-root", "--notebook-dir=/mnt/notebooks"]
CMD ["jupyter", "lab", "--no-browser", "--ip=0.0.0.0", "--allow-root", "--notebook-dir=/notebooks", "--config=$JUPYTER_DIR/jupyter_notebook_config.py"]
